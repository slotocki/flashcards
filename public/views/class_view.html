<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klasa - MemoRise</title>
    <link href="/public/styles/main.css" rel="stylesheet">
</head>
<body>
    <nav>
        <div class="nav-brand">
            <a href="/dashboard"><img src="/public/images/logo.png" alt="MemoRise Logo" class="logo"></a>
        </div>
        <ul>
            <li><a href="/dashboard">Strona g≈Ç√≥wna</a></li>
            <li><a href="/community">Spo≈Çeczno≈õƒá</a></li>
            <li><a href="/progress">Tw√≥j progres</a></li>
            <li><a href="/account">Twoje konto</a></li>
            <li><a href="#" onclick="logout(); return false;">Wyloguj</a></li>
        </ul>
    </nav>

    <div class="container">
        <main class="class-view-container">
            <header class="class-header">
                <a href="/dashboard" class="back-link">‚Üê Wr√≥ƒá do klas</a>
                <div class="class-title-section">
                    <span class="class-flag" id="classFlag">üìö</span>
                    <div>
                        <h1 id="className">≈Åadowanie...</h1>
                        <p class="class-teacher" id="classTeacher"></p>
                    </div>
                </div>
            </header>
            
            <section class="decks-section">
                <h2>Zestawy fiszek</h2>
                <div class="decks-grid" id="decksList">
                    <p class="loading">≈Åadowanie zestaw√≥w...</p>
                </div>
            </section>
            
            <section class="tasks-section" id="tasksSection" style="display: none;">
                <h2>Zadania do wykonania</h2>
                <div class="tasks-list" id="tasksList"></div>
            </section>
        </main>
    </div>

    <script src="/public/scripts/api.js"></script>
    <script src="/public/scripts/shared.js"></script>
    <script src="/public/scripts/auth.js"></script>
    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const classId = urlParams.get('id');
        
        if (!classId) {
            window.location.href = '/dashboard';
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            await loadClassDetails();
            await loadDecks();
            await loadTasks();
        });
        
        async function loadClassDetails() {
            try {
                const result = await API.classes.get(classId);
                
                if (result.ok) {
                    const cls = result.data;
                    document.getElementById('className').textContent = cls.name;
                    document.getElementById('classTeacher').textContent = `Nauczyciel: ${cls.teacherName}`;
                    document.getElementById('classFlag').innerHTML = getLanguageFlagHtml(cls.language);
                    document.title = `${cls.name} - MemoRise`;
                } else {
                    document.getElementById('className').textContent = 'Nie znaleziono klasy';
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        async function loadDecks() {
            const container = document.getElementById('decksList');
            
            try {
                const result = await API.decks.listByClass(classId);
                
                if (result.ok && result.data.length > 0) {
                    // U≈ºywamy ustandaryzowanego szablonu z shared.js
                    // Kontener ma ju≈º klasƒô decks-grid z HTML, wiƒôc nie dodajemy wewnƒôtrznego kontenera
                    container.innerHTML = result.data.map(deck => 
                        createDeckCardHtml(deck, {
                            actionButton: {
                                text: 'Rozpocznij naukƒô',
                                href: `/study?deckId=${deck.id}`
                            }
                        })
                    ).join('');
                } else {
                    container.innerHTML = '<p class="no-data">Brak zestaw√≥w w tej klasie</p>';
                }
            } catch (error) {
                container.innerHTML = '<p class="error">B≈ÇƒÖd ≈Çadowania zestaw√≥w</p>';
            }
        }
        
        async function loadTasks() {
            try {
                const result = await API.classes.tasks(classId);
                
                if (result.ok && result.data.length > 0) {
                    const container = document.getElementById('tasksList');
                    const section = document.getElementById('tasksSection');
                    section.style.display = 'block';
                    
                    container.innerHTML = result.data.map(task => `
                        <div class="task-card">
                            <div class="task-info">
                                <h3>${escapeHtml(task.title)}</h3>
                                <p>${task.description || ''}</p>
                            </div>
                            ${task.dueDate ? `<span class="task-due">Termin: ${new Date(task.dueDate).toLocaleDateString('pl-PL')}</span>` : ''}
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading tasks:', error);
            }
        }
        
        // getLevelLabel(), escapeHtml(), createDeckCardHtml() - u≈ºywamy z shared.js
    </script>
</body>
</html>